<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Quản lý danh mục</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
  body {
    overflow-x: hidden;
    min-height: 100vh;
  }

  .sidebar {
    height: 100vh;
    width: 220px;
    background-color: #343a40;
    color: white;
    position: fixed;
    top: 0;
    left: 0;
    padding: 1rem;
    transition: all 0.3s;
    z-index: 1000;
  }

  .sidebar.collapsed {
    width: 70px;
  }

  .sidebar .nav-link {
    color: white;
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    white-space: nowrap;
  }

  .sidebar .nav-link i {
    margin-right: 8px;
  }

  .sidebar .nav-link:hover {
    background-color: #495057;
  }

  .main {
    padding-left: 220px;
    padding-right: 1rem;
    padding-top: 2rem;
    padding-bottom: 2rem;
    transition: padding-left 0.3s;
  }

  .main.collapsed {
    padding-left: 70px;
  }

  .icon-btn {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.5rem;
  }

  img.category-img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #dee2e6;
  }

  footer {
    background-color: #212529;
    color: #fff;
    text-align: center;
    padding: 1rem;
    margin-top: 2rem;
    border-radius: 0.5rem;
  }

  @media (max-width: 768px) {
    .sidebar {
      position: absolute;
      z-index: 1050;
    }

    .main {
      padding-left: 0 !important;
    }

    .main.collapsed {
      padding-left: 0 !important;
    }
  }
</style>
</head>
<body class="bg-light">

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <span class="fs-5 fw-bold">Admin</span>
    <button class="btn btn-sm btn-outline-light" onclick="toggleSidebar()">
      <i class="bi bi-list"></i>
    </button>
  </div>
  <ul class="nav flex-column">
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/categories}"><i class="bi bi-folder2"></i> Danh mục</a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/orders}"><i class="bi bi-bag-check"></i> Đơn hàng</a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/products/list}"><i class="bi bi-box"></i> Sản phẩm</a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/promotions/list}"><i class="bi bi-percent"></i> Khuyến mãi</a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/reviews}"><i class="bi bi-chat-left-text"></i> Đánh giá</a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/suppliers}"><i class="bi bi-truck"></i> Nhà cung cấp</a></li>
  </ul>
</div>

<!-- Main content -->
<div id="main" class="main">

  <div class="container-fluid">
    <!-- Tiêu đề -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="fw-bold text-primary">
        <i class="bi bi-folder2 me-2"></i> Quản lý danh mục
      </h1>
      <a th:href="@{/admin/categories/add}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i> Thêm mới
      </a>
    </div>

    <!-- Tìm kiếm -->
    <form th:action="@{/admin/categories}" method="get" class="input-group mb-4">
      <input type="text" name="keyword" th:value="${keyword}" class="form-control" placeholder="Tìm kiếm danh mục...">
      <button class="btn btn-outline-secondary" type="submit">
        <i class="bi bi-search"></i>
      </button>
    </form>

    <!-- Thông báo -->
    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Bảng danh sách -->
    <div class="table-responsive bg-white shadow-sm rounded-4 p-3">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light text-center">
        <tr>
          <th>ID</th>
          <th>Tên danh mục</th>
          <th>Nhà cung cấp</th>
          <th>Ảnh</th>
          <th>Ngày tạo</th>
          <th>Ngày cập nhật</th>
          <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="category : ${categoriesPage?.content}">
          <td th:text="${category.categoryId}"></td>
          <td th:text="${category.name}"></td>

          <td>
            <img th:if="${category.images != null and category.images != ''}"
                 th:src="@{/images/{img}(img=${category.images})}"
                 class="category-img" alt="Ảnh">
          </td>
          <td th:text="${#temporals.format(category.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
          <td th:text="${#temporals.format(category.updatedAt, 'dd/MM/yyyy HH:mm')}"></td>
          <td>
            <div class="d-flex justify-content-center gap-2 flex-wrap">
              <a th:href="@{/admin/categories/view/{id}(id=${category.categoryId})}" class="btn btn-outline-info btn-sm icon-btn" title="Xem">
                <i class="bi bi-info-circle"></i>
              </a>
              <a th:href="@{/admin/categories/edit/{id}(id=${category.categoryId})}" class="btn btn-outline-warning btn-sm icon-btn" title="Sửa">
                <i class="bi bi-pencil-square"></i>
              </a>
              <a th:href="@{/admin/categories/delete/{id}(id=${category.categoryId})}"
                 onclick="return confirm('Bạn có chắc muốn xóa danh mục này?')"
                 class="btn btn-outline-danger btn-sm icon-btn" title="Xóa">
                <i class="bi bi-trash"></i>
              </a>
              <a th:href="@{/admin/categories/toggle-hidden/{id}(id=${category.categoryId})}"
                 th:classappend="${category.hidden} ? 'btn-secondary' : 'btn-outline-secondary'"
                 class="btn btn-sm icon-btn" th:title="${category.hidden} ? 'Hiện danh mục' : 'Ẩn danh mục'">
                <i class="bi" th:classappend="${category.hidden} ? 'bi-eye-slash' : 'bi-eye'"></i>
              </a>
            </div>
          </td>
        </tr>
        <tr th:if="${categoriesPage == null or categoriesPage.content.isEmpty()}">
          <td colspan="7" class="text-center text-muted">Không tìm thấy danh mục nào.</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Phân trang -->
    <nav th:if="${totalPages != null and totalPages > 1}" class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item" th:if="${currentPage > 0}">
          <a class="page-link" th:href="@{/admin/categories(page=(${currentPage}-1), keyword=${keyword})}">
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>
        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages-1)}"
            th:classappend="${i == currentPage} ? 'active'">
          <a class="page-link" th:href="@{/admin/categories(page=${i}, keyword=${keyword})}" th:text="${i+1}"></a>
        </li>
        <li class="page-item" th:if="${currentPage < totalPages-1}">
          <a class="page-link" th:href="@{/admin/categories(page=(${currentPage}+1), keyword=${keyword})}">
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5 rounded-3">
      <small>© 2025 Admin Dashboard. All rights reserved.</small>
    </footer>
  </div>
</div>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('main');
    sidebar.classList.toggle('collapsed');
    main.classList.toggle('collapsed');
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
