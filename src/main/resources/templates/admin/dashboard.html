<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${title}">Bảng điều khiển</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

  <style>
    body {
      overflow-x: hidden;
    }

    .sidebar {
      width: 220px;
      height: 100vh;
      background-color: #343a40;
      color: white;
      position: fixed;
      top: 0;
      left: 0;
      transition: width 0.3s ease;
      z-index: 1000;
    }

    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar .nav-link {
      color: white;
    }

    .sidebar .nav-link:hover {
      background-color: #495057;
    }

    .sidebar .nav-icon {
      margin-right: 8px;
    }

    .main-content {
      margin-left: 220px;
      transition: margin-left 0.3s ease;
    }

    .sidebar.collapsed + .main-content {
      margin-left: 70px;
    }

    @media (max-width: 768px) {
      .sidebar {
        position: absolute;
        width: 0;
        overflow: hidden;
      }

      .sidebar.expanded {
        width: 220px;
      }

      .main-content {
        margin-left: 0;
      }

      .sidebar.expanded + .main-content {
        margin-left: 220px;
      }
    }
  </style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar" class="sidebar expanded p-3">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <span class="fs-5 fw-bold d-none d-md-inline">Admin</span>
    <button class="btn btn-sm btn-outline-light" onclick="toggleSidebar()">
      <i class="bi bi-list"></i>
    </button>
  </div>
  <ul class="nav flex-column">
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/categories}"><i class="bi bi-tags nav-icon"></i> <span class="d-none d-md-inline">Danh mục</span></a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/orders}"><i class="bi bi-bag-check nav-icon"></i> <span class="d-none d-md-inline">Đơn hàng</span></a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/products/list}"><i class="bi bi-box nav-icon"></i> <span class="d-none d-md-inline">Sản phẩm</span></a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/Promotions/list}"><i class="bi bi-percent nav-icon"></i> <span class="d-none d-md-inline">Khuyến mãi</span></a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/reviews}"><i class="bi bi-chat-left-text nav-icon"></i> <span class="d-none d-md-inline">Đánh giá</span></a></li>
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/suppliers}"><i class="bi bi-truck nav-icon"></i> <span class="d-none d-md-inline">Nhà cung cấp</span></a></li>
  </ul>
</div>

<!-- Main Content -->
<div id="main-content" class="main-content p-4">
  <h2 class="mb-4 fw-bold">Bảng điều khiển</h2>

  <!-- Tổng quan -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Tổng người dùng</h5>
          <p class="fs-3 fw-bold" th:text="${totalUsers != null ? totalUsers : 0}">0</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Tổng doanh thu</h5>
          <p class="fs-3 fw-bold text-success">
            <span th:text="${totalRevenue != null ? #numbers.formatDecimal(totalRevenue, 0, 2) : '0.00'}">0.00</span> ₫
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Biểu đồ doanh thu -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Doanh thu theo tháng</h5>
      <canvas id="revenueChart" height="100"></canvas>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('main-content');

    sidebar.classList.toggle('collapsed');
    sidebar.classList.toggle('expanded');
  }
</script>

<!-- Chart Script -->
<script th:inline="javascript">
  /*<![CDATA[*/
  const revenueData = /*[[${monthlyRevenue}]]*/ [];
  const labels = Array.from({length: 12}, (_, i) => `Tháng ${i + 1}`);
  const data = [];

  for (let i = 0; i < 12; i++) {
    data.push(revenueData[i] || 0);
  }

  new Chart(document.getElementById('revenueChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Doanh thu (VND)',
        data: data,
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return new Intl.NumberFormat('vi-VN').format(value) + ' ₫';
            }
          }
        }
      }
    }
  });
  /*]]>*/
</script>

</body>
</html>
