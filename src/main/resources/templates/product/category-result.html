<div xmlns:th="http://www.thymeleaf.org" th:fragment="content">

    <div class="container my-5">

        <!-- üîç FORM L·ªåC -->
        <form method="get" th:action="@{/products/category/{id}(id=${categoryId})}" class="mb-4 border p-4 rounded bg-light shadow-sm">
            <div class="row g-3 align-items-end">

                <!-- üí∏ Gi√° t·ª´ -->
                <div class="col-md-2">
                    <label class="form-label fw-semibold" th:text="#{category.filter.priceFrom}">Gi√° t·ª´ (ƒë)</label>
                    <input type="number" name="minPrice" class="form-control" th:value="${minPrice}" placeholder="VD: 1000000">
                </div>

                <!-- üí∞ Gi√° ƒë·∫øn -->
                <div class="col-md-2">
                    <label class="form-label fw-semibold" th:text="#{category.filter.priceTo}">Gi√° ƒë·∫øn (ƒë)</label>
                    <input type="number" name="maxPrice" class="form-control" th:value="${maxPrice}" placeholder="VD: 5000000">
                </div>

                <!-- üè¢ Nh√† cung c·∫•p -->
                <div class="col-md-4">
                    <label class="form-label fw-semibold" th:text="#{category.filter.suppliers}">Nh√† cung c·∫•p</label>
                    <div class="d-flex flex-wrap">
                        <div class="form-check me-3 mb-2" th:each="supplier : ${allSuppliers}">
                            <input class="form-check-input" type="checkbox" name="supplierIds"
                                   th:id="'sup_' + ${supplier.supplierId}"
                                   th:value="${supplier.supplierId}"
                                   th:checked="${selectedSuppliers != null and selectedSuppliers.contains(supplier.supplierId)}">
                            <label class="form-check-label" th:for="'sup_' + ${supplier.supplierId}"
                                   th:text="${supplier.name}">Supplier</label>
                        </div>
                    </div>
                </div>

                <!-- üìä S·∫Øp x·∫øp -->
                <div class="col-md-2">
                    <label class="form-label fw-semibold" th:text="#{category.filter.sortBy}">S·∫Øp x·∫øp theo</label>
                    <select class="form-select" name="sortBy" onchange="this.form.submit()">
                        <option th:value="'newest'" th:selected="${sortBy == null or sortBy == 'newest'}" th:text="#{category.filter.sort.newest}">M·ªõi nh·∫•t</option>
                        <option th:value="'cheapest'" th:selected="${sortBy == 'cheapest'}" th:text="#{category.filter.sort.cheapest}">Gi√° r·∫ª nh·∫•t</option>
                        <option th:value="'expensive'" th:selected="${sortBy == 'expensive'}" th:text="#{category.filter.sort.expensive}">Gi√° cao nh·∫•t</option>
                    </select>
                </div>

                <!-- üîò N√∫t l·ªçc + Xo√° -->
                <div class="col-md-2 d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-100" th:text="#{category.filter.button.filter}">L·ªçc</button>
                    <a th:href="@{/products/category/{id}(id=${categoryId})}" class="btn btn-outline-secondary w-100" th:text="#{category.filter.button.clear}">Xo√°</a>
                </div>
            </div>
        </form>

        <!-- üè∑Ô∏è Ti√™u ƒë·ªÅ -->
        <div class="row mb-3">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h3 class="text-success">
                    <i class="bi bi-tags me-2"></i><span th:text="#{category.title}">S·∫£n ph·∫©m theo danh m·ª•c</span>
                </h3>
                <p class="text-muted mb-0">
                    <span th:text="#{category.found}">T√¨m th·∫•y</span>
                    <strong th:text="${products.size()}">0</strong>
                    <span th:text="#{category.productCount}">s·∫£n ph·∫©m</span>
                </p>
            </div>
        </div>

        <!-- ‚úÖ Danh s√°ch s·∫£n ph·∫©m -->
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mb-4">
            <div class="col" th:each="product : ${products}">
                <div class="card h-100 shadow-sm">
                    <a th:href="@{/products/detail/{id}(id=${product.id})}">
                        <img th:if="${product.image != null}"
                             th:src="@{/images/{img}(img=${product.image})}"
                             class="card-img-top" alt="Product Image" />
                    </a>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${product.name}">T√™n s·∫£n ph·∫©m</h5>

                        <!-- üîñ Gi√° -->
                        <div th:if="${product.onSale}">
                            <p class="card-text text-muted text-decoration-line-through mb-1"
                               th:text="${#numbers.formatDecimal(product.originalPrice, 0, 'POINT', 3, 'COMMA') + ' ƒë'}"></p>
                            <p class="card-text text-danger fw-bold"
                               th:text="${#numbers.formatDecimal(product.discountedPrice, 0, 'POINT', 3, 'COMMA') + ' ƒë'}"></p>
                        </div>
                        <div th:if="${!product.onSale}">
                            <p class="card-text fw-semibold"
                               th:text="${#numbers.formatDecimal(product.originalPrice, 0, 'POINT', 3, 'COMMA') + ' ƒë'}"></p>
                        </div>

                        <!-- üõí Th√™m v√†o gi·ªè -->
                        <form th:action="@{/user/cart/add}" method="post" class="mt-auto d-flex align-items-center pt-2">
                            <input type="hidden" th:name="productId" th:value="${product.id}" />
                            <input type="number" name="quantity" value="1" min="1"
                                   class="form-control text-center me-2" style="width: 70px;" />
                            <button type="submit" class="btn btn-sm btn-primary">
                                <i class="bi bi-cart-plus me-1"></i><span th:text="#{category.addToCart}">Th√™m v√†o gi·ªè</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- üî¢ PH√ÇN TRANG -->
        <div class="row">
            <div class="col-12">
                <nav aria-label="Category pagination">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:each="page : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${page == currentPage} ? 'active'">
                            <a class="page-link"
                               th:href="@{/products/category/{id}(id=${categoryId}, page=${page},
                     minPrice=${minPrice}, maxPrice=${maxPrice},
                     supplierIds=${selectedSuppliers}, sortBy=${sortBy})}"
                               th:text="${page + 1}">1</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>